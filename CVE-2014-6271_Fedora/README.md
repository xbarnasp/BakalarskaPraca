# Otestovanie zraniteľnosti Shellshock na distribúcii Fedora 20

CVE-2014-6271, známe aj ako „Shellshock“, bolo objavené v septembri 2014 bezpečnostným výskumníkom Stéphane Chazelasom.
Využíva chybu v príkazovom interpretery Bash od verzie 1.14 po 4.3. Zraniteľné boli všetky zariadenia,
ktoré ho používali. Vzdialenému útoku boli však vystavení iba používatelia, ktorí boli pripojení na internet. Okrem
toho je potrebný určitý softvér, ktorý poskytuje cestu, cez ktorú sa útočník môže dostať k príkazovému interpreteru
Bash, napríklad pri webovom serveri Apache je to CGI, ktorý slúži na interakciu s jeho programami. Experti
vypočítali, že „Shellshock“ sa týkal vyše 500 miliónov zariadení.

Zraniteľnosť vzniká kvôli chybe v spracovaní premenných prostredia v príkazovom interpretery Bash, najmä definície
funkcií. Toto sa dá zneužiť na vykonanie ľubovoľného kódu, získanie neoprávneného prístupu k systému, poprípade
vykonanie rôznych útokov, ako napríklad DoS, *Code Injection* alebo *Remote Command Execution*.

## Konfigurácia distribúcie Fedora

Pre otestovanie sme si stiahli verziu webového servera Apache verzie 2.4.10 a overili verziu príkazového interpreteru
Bash, ktorá bola verzie 4.2.15. Následne sme si vytvorili a vložili na server CGI skript, konkrétne `hw.sh`. Všetko
sme zabalili a nahrali na server Vagrant, čiže vo Vagrant súbore sme stiahli už nakonfigurovanú distribúciu Fedora 20
a pridali sme ešte doplnok `setroubleshoot`, ktorý slúži na zobrazenie porušenia politiky modulu SELinux. 

## Konfigurácia Kali Linux

Pre zaútočenie sme vložili súbor `set-msfconsole.rc` a `HACK.sh` na plochu distribúcie Kali. Útok spustíme otvorením konzoly a spustením príkazu:

```shell
./Desktop/HACK.sh
```

`HACK.sh` nám otvorí v konzole nástroj msfconsole pomocou súboru `set-msfconsole.rc`. V ňom sa nastaví IP zraniteľnej mašiny pomocou
`set RHOSTS 192.168.50.22` a cesta `set TARGETURI /cgi-bin/hw.sh`, čo nám nastaví cestu k skriptu CGI.
Ostáva nám nastaviť IP útočníka `set LHOST 192.168.50.23` a spustiť útok.

Po spustení útoku zistíme, že sme sa do systému nedostali a bezpečnostný modul SELinux útoku zabránil. Môžme si to overiť
napísaním príkazu `sealert -b`, ktorý nám vypíše, čomu modul SELinux zabránil. V tomto prípade zabránil v spustení príkazu 
mimo bezpečnostný profil httpd_sys_script_t. 

Pokiaľ by sme si chceli overiť, či naozaj prieniku zabránil bezpečnostný modul SELinux, možme ho vypnuť pomocou
`sudo setenforce 0` a spustiť útok znova. Prebehol úspešne, avšak nezískali sme priviléciá *root*.
